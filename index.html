<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datamorgana - Dashboard Analisis UMKM Jawa Timur</title>
    <!-- Memuat Tailwind CSS dari CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* Menggunakan font Inter sebagai font utama */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f1f5f9; /* slate-100 */
        }

        /* Styling tambahan untuk scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Styling untuk Navigasi Sidebar */
        .nav-link.active {
            background-color: #14b8a6; /* teal-500 */
            color: #ffffff;
        }
        .nav-link.active svg {
            color: #ffffff;
        }

        /* Styling untuk panel konten */
        .page-panel {
            display: none;
        }
        .page-panel.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .soft-shadow {
             box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.05);
        }
        
        /* Styling untuk Donut Chart */
        .donut-chart {
            width: 200px; /* Diperbesar dari 150px */
            height: 200px; /* Diperbesar dari 150px */
            border-radius: 50%;
            background: conic-gradient(
                #14b8a6 0% 49%,   /* Perdagangan */
                #2dd4bf 49% 73%,  /* Jasa */
                #5eead4 73% 85%,  /* Pertanian */
                #99f6e4 85% 95%,  /* Manufaktur */
                #ccfbf1 95% 100%  /* FnB */
            );
        }
    </style>
</head>
<body class="text-slate-700">

    <div class="flex h-screen bg-slate-100">
        <!-- Sidebar Navigasi -->
        <aside class="w-64 flex-shrink-0 p-4">
            <div class="h-full flex flex-col p-4 bg-white/80 backdrop-blur-lg rounded-2xl soft-shadow">
                <div class="text-center py-4">
                    <h1 class="text-2xl font-bold text-slate-800">Datamorgana</h1>
                    <p class="text-xs text-slate-500 mt-1">UMKM Innovation Dashboard</p>
                </div>
                <nav class="mt-8 flex-grow">
                    <ul class="space-y-2">
                        <li><a href="#" class="nav-link active flex items-center gap-3 py-3 px-4 rounded-lg text-sm font-semibold text-slate-600 hover:bg-teal-500/10 hover:text-teal-600 transition-all cursor-pointer" data-target="panel-overview"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg> Overview</a></li>
                        <li><a href="#" class="nav-link flex items-center gap-3 py-3 px-4 rounded-lg text-sm font-semibold text-slate-600 hover:bg-teal-500/10 hover:text-teal-600 transition-all cursor-pointer" data-target="panel-iipl-rank"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a1 1 0 011-1h14a1 1 0 110 2H3a1 1 0 01-1-1z" /></svg> Peringkat IIPL</a></li>
                        <li><a href="#" class="nav-link flex items-center gap-3 py-3 px-4 rounded-lg text-sm font-semibold text-slate-600 hover:bg-teal-500/10 hover:text-teal-600 transition-all cursor-pointer" data-target="panel-sertifikasi"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg> Sertifikasi</a></li>
                        <li><a href="#" class="nav-link flex items-center gap-3 py-3 px-4 rounded-lg text-sm font-semibold text-slate-600 hover:bg-teal-500/10 hover:text-teal-600 transition-all cursor-pointer" data-target="panel-pasar-global"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.022 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" /></svg> Pasar Global</a></li>
                        <li><a href="#" class="nav-link flex items-center gap-3 py-3 px-4 rounded-lg text-sm font-semibold text-slate-600 hover:bg-teal-500/10 hover:text-teal-600 transition-all cursor-pointer" data-target="panel-digital"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm4 1a1 1 0 00-1 1v1a1 1 0 001 1h1a1 1 0 001-1V7a1 1 0 00-1-1H6zM6 11a1 1 0 00-1 1v1a1 1 0 001 1h1a1 1 0 001-1v-1a1 1 0 00-1-1H6zM9 7a1 1 0 00-1 1v1a1 1 0 001 1h5a1 1 0 001-1V7a1 1 0 00-1-1H9zM9 11a1 1 0 00-1 1v1a1 1 0 001 1h5a1 1 0 001-1v-1a1 1 0 00-1-1H9z" /></svg> Go Digital</a></li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Konten Utama -->
        <main class="flex-1 p-4 overflow-y-auto">
            <div class="h-full flex flex-col space-y-6">
                <!-- Header Konten -->
                <header>
                    <p class="text-slate-500">Memetakan Kualitas Inovasi untuk Mendorong Pertumbuhan Ekonomi Daerah.</p>
                </header>

                <!-- Kartu Metrik Utama -->
                <section class="grid grid-cols-2 md:grid-cols-4 gap-5">
                    <div class="bg-white p-6 rounded-2xl soft-shadow transition-transform duration-300 hover:-translate-y-1"><h3 class="text-sm font-medium text-slate-500">Total UMKM</h3><p class="text-3xl font-extrabold text-slate-800 mt-1">9.7 Jt</p></div>
                    <div class="bg-white p-6 rounded-2xl soft-shadow transition-transform duration-300 hover:-translate-y-1"><h3 class="text-sm font-medium text-slate-500">Kontribusi PDRB</h3><p class="text-3xl font-extrabold text-slate-800 mt-1">57%</p></div>
                    <div class="bg-white p-6 rounded-2xl soft-shadow transition-transform duration-300 hover:-translate-y-1"><h3 class="text-sm font-medium text-slate-500">Penyerapan T. Kerja</h3><p class="text-3xl font-extrabold text-slate-800 mt-1">90%</p></div>
                    <div class="bg-white p-6 rounded-2xl soft-shadow transition-transform duration-300 hover:-translate-y-1"><h3 class="text-sm font-medium text-slate-500">UMKM Go Digital</h3><p class="text-3xl font-extrabold text-slate-800 mt-1">1.2 Jt</p></div>
                </section>
                
                <!-- Konten Panel Dinamis -->
                <section id="page-content" class="flex-grow">
                    <!-- Panel Overview -->
                    <div id="panel-overview" class="page-panel active">
                         <div class="bg-white h-full p-6 rounded-2xl soft-shadow">
                            <h3 class="font-bold text-lg text-slate-800 mb-6 text-center">Distribusi UMKM Berdasarkan Sektor</h3>
                            <div class="flex flex-col md:flex-row items-center justify-center gap-12">
                               <div class="donut-chart relative">
                                   <canvas id="umkmDonutChart" width="300" height="300"></canvas>
                                   <div class="absolute inset-5 bg-white rounded-full"></div>
                               </div>
                                <ul class="space-y-3 text-base">
                                    <li class="flex items-center gap-3"><div class="w-4 h-4 rounded-full bg-teal-600"></div><span class="font-semibold text-slate-700">Perdagangan:</span><span class="text-slate-500">48% (~4.8 Jt)</span></li>
                                    <li class="flex items-center gap-3"><div class="w-4 h-4 rounded-full bg-teal-500"></div><span class="font-semibold text-slate-700">Jasa:</span><span class="text-slate-500">23% (~2.3 Jt)</span></li>
                                    <li class="flex items-center gap-3"><div class="w-4 h-4 rounded-full bg-teal-400"></div><span class="font-semibold text-slate-700">Pertanian:</span><span class="text-slate-500">12% (~1.2 Jt)</span></li>
                                    <li class="flex items-center gap-3"><div class="w-4 h-4 rounded-full bg-teal-300"></div><span class="font-semibold text-slate-700">Manufaktur:</span><span class="text-slate-500">10% (~970 Rb)</span></li>
                                    <li class="flex items-center gap-3"><div class="w-4 h-4 rounded-full bg-teal-200"></div><span class="font-semibold text-slate-700">FnB:</span><span class="text-slate-500">7% (~730 Rb)</span></li>
                                    <li class="flex items-center gap-3"><div class="w-4 h-4 rounded-full bg-teal-100"></div><span class="font-semibold text-slate-700">Kosmetik:</span><span class="text-slate-500">4% (~370 Rb)</span></li>
                                </ul>
                            </div>
                         </div>
                    </div>

                    <!-- Panel Peringkat IIPL -->
                    <div id="panel-iipl-rank" class="page-panel">
                        <div class="bg-white h-full p-6 rounded-2xl soft-shadow">
                            <h3 class="font-bold text-lg text-slate-800 mb-4 text-center">Peringkat IIPL Kabupaten/Kota</h3>
                            <div id="iipl-ranking-list" class="space-y-3 text-sm max-w-xl mx-auto">
                                <!-- Data Peringkat akan di-generate oleh JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Panel Sertifikasi -->
                    <div id="panel-sertifikasi" class="page-panel">
                         <div class="grid md:grid-cols-2 gap-6 h-full">
                            <div class="bg-white p-6 rounded-2xl soft-shadow">
                                <h3 class="font-bold text-lg text-slate-800 mb-4 text-center">UMKM Sertifikasi Halal</h3>
                                <div class="w-full h-64 flex justify-around items-end gap-3 text-xs text-center">
                                    <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">22.1k</p><div class="w-full bg-teal-400 rounded-t" style="height: 100%"></div><span>Lamongan</span></div>
                                    <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">19.8k</p><div class="w-full bg-teal-400 rounded-t" style="height: 90%"></div><span>Surabaya</span></div>
                                    <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">14.6k</p><div class="w-full bg-teal-400 rounded-t" style="height: 66%"></div><span>Kab. Kediri</span></div>
                                    <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">14.6k</p><div class="w-full bg-teal-400 rounded-t" style="height: 66%"></div><span>Kota Kediri</span></div>
                                    <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">11.8k</p><div class="w-full bg-teal-400 rounded-t" style="height: 54%"></div><span>Jombang</span></div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-2xl soft-shadow">
                                <h3 class="font-bold text-lg text-slate-800 mb-4 text-center">UMKM Sertifikasi HKI</h3>
                                <div class="w-full h-64 flex justify-around items-end gap-3 text-xs text-center">
                                    <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">18.5k</p><div class="w-full bg-teal-400 rounded-t" style="height: 100%"></div><span>Surabaya</span></div>
                                    <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">6.2k</p><div class="w-full bg-teal-400 rounded-t" style="height: 34%"></div><span>Kota Malang</span></div>
                                    <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">3.7k</p><div class="w-full bg-teal-400 rounded-t" style="height: 21%"></div><span>Kab. Malang</span></div>
                                    <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">2.9k</p><div class="w-full bg-teal-400 rounded-t" style="height: 16%"></div><span>Sidoarjo</span></div>
                                    <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">2.2k</p><div class="w-full bg-teal-400 rounded-t" style="height: 12%"></div><span>Jember</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Panel Pasar Global -->
                    <div id="panel-pasar-global" class="page-panel">
                        <div class="bg-white h-full p-6 rounded-2xl soft-shadow">
                            <h3 class="font-bold text-lg text-slate-800 mb-4 text-center">UMKM Ekspor dan Pameran</h3>
                            <div class="flex items-center justify-center gap-4 text-xs mb-6">
                                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-sm bg-teal-500"></div><span>Ekspor</span></div>
                                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-sm bg-teal-200"></div><span>Pameran</span></div>
                            </div>
                            <div class="w-full h-64 flex justify-around items-end gap-4 text-xs text-center">
                                <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">1,561</p><div class="w-full flex flex-col-reverse rounded-t overflow-hidden" style="height: 100%"><div class="bg-teal-200" style="height: 93%"></div><div class="bg-teal-500" style="height: 7%"></div></div><span>Kab. Malang</span></div>
                                <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">1,501</p><div class="w-full flex flex-col-reverse rounded-t overflow-hidden" style="height: 96%"><div class="bg-teal-200" style="height: 67%"></div><div class="bg-teal-500" style="height: 33%"></div></div><span>Surabaya</span></div>
                                <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">1,151</p><div class="w-full flex flex-col-reverse rounded-t overflow-hidden" style="height: 74%"><div class="bg-teal-200" style="height: 74%"></div><div class="bg-teal-500" style="height: 26%"></div></div><span>Sidoarjo</span></div>
                                <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">981</p><div class="w-full flex flex-col-reverse rounded-t overflow-hidden" style="height: 63%"><div class="bg-teal-200" style="height: 79%"></div><div class="bg-teal-500" style="height: 21%"></div></div><span>Pasuruan</span></div>
                                <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">899</p><div class="w-full flex flex-col-reverse rounded-t overflow-hidden" style="height: 58%"><div class="bg-teal-200" style="height: 87%"></div><div class="bg-teal-500" style="height: 13%"></div></div><span>Jember</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Panel Go Digital -->
                    <div id="panel-digital" class="page-panel">
                        <div class="bg-white h-full p-6 rounded-2xl soft-shadow">
                            <h3 class="font-bold text-lg text-slate-800 mb-4 text-center">Top 5 UMKM Go Digital</h3>
                            <div class="w-full h-64 flex justify-around items-end gap-3 text-xs text-center">
                                <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">166k</p><div class="w-full bg-teal-400 rounded-t" style="height: 100%"></div><span>Surabaya</span></div>
                                <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">127k</p><div class="w-full bg-teal-400 rounded-t" style="height: 77%"></div><span>Kab. Malang</span></div>
                                <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">110k</p><div class="w-full bg-teal-400 rounded-t" style="height: 67%"></div><span>Sidoarjo</span></div>
                                <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">105k</p><div class="w-full bg-teal-400 rounded-t" style="height: 64%"></div><span>Banyuwangi</span></div>
                                <div class="flex flex-col-reverse items-center gap-2 w-full h-full"><p class="font-semibold text-teal-600">95k</p><div class="w-full bg-teal-400 rounded-t" style="height: 58%"></div><span>Jember</span></div>
                            </div>
                        </div>
                    </div>
                    

                    <!-- Panel Choropleth Map -->
                    <div id="panel-map" class="page-panel active">
                        <div class="bg-white h-full p-6 rounded-2xl soft-shadow">
                            <h3 class="font-bold text-lg text-slate-800 mb-6 text-center">Peta IIPL Jawa Timur</h3>
                            <div id="map" class="w-full h-[600px] rounded-xl overflow-hidden"></div>
                        </div>
                    </div>

                </section>
            </div>
        </main>
    </div>

    <script>
        // JavaScript untuk fungsionalitas Navigasi Sidebar
        const navLinks = document.querySelectorAll('.nav-link');
        const pagePanels = document.querySelectorAll('.page-panel');

        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault(); // Mencegah link # bekerja

                // Nonaktifkan semua link dan panel
                navLinks.forEach(nav => nav.classList.remove('active'));
                pagePanels.forEach(panel => panel.classList.remove('active'));

                // Aktifkan link yang diklik dan panel yang sesuai
                link.classList.add('active');
                const targetPanelId = link.getAttribute('data-target');
                document.getElementById(targetPanelId).classList.add('active');
            });
        });

        // --- JavaScript untuk Peringkat IIPL ---
        const iiplData = [
            { name: 'Kota Surabaya', score: 0.42 },
            { name: 'Kab. Lamongan', score: 0.23 },
            { name: 'Kab. Malang', score: 0.22 },
            { name: 'Kota Kediri', score: 0.21 },
            { name: 'Kab. Banyuwangi', score: 0.20 },
            { name: 'Kab. Pasuruan', score: 0.20 },
            { name: 'Kab. Kediri', score: 0.19 },
            { name: 'Kab. Gresik', score: 0.17 },
            { name: 'Kota Blitar', score: 0.17 },
            { name: 'Kab. Sidoarjo', score: 0.17 }
        ];

        const iiplListContainer = document.getElementById('iipl-ranking-list');

        function renderIiplRankings(data) {
            iiplListContainer.innerHTML = ''; // Kosongkan container
            const maxScore = Math.max(...data.map(item => item.score));

            data.forEach(item => {
                const barWidth = (item.score / maxScore) * 100;
                const rowHtml = `
                    <div class="grid grid-cols-[1fr,2fr,auto] items-center gap-3">
                        <span class="text-right text-slate-500">${item.name}</span>
                        <div class="h-5 bg-teal-500 rounded" style="width: ${barWidth}%;"></div>
                        <span class="font-medium text-slate-600">${item.score.toFixed(2)}</span>
                    </div>
                `;
                iiplListContainer.innerHTML += rowHtml;
            });
        }
        
        // Render peringkat IIPL (hanya tertinggi) saat halaman dimuat
        const sortedData = [...iiplData].sort((a, b) => b.score - a.score);
        renderIiplRankings(sortedData);
    </script>

    <!-- Script Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('umkmDonutChart').getContext('2d');
        const umkmDonutChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Perdagangan', 'Jasa', 'Pertanian', 'Manufaktur', 'FnB', 'Kosmetik'],
                datasets: [{
                    data: [48, 23, 12, 10, 7, 4],
                    backgroundColor: [
                        '#0f766e', '#14b8a6', '#2dd4bf', '#5eead4', '#99f6e4', '#ccfbf1'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    </script>

    <!-- Leaflet & Map Script -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js">
    </script>
    <script>
        // Inisialisasi Peta
        const map = L.map('map').setView([-7.5, 112.7], 8); // Koordinat Jawa Timur
        // Tambahkan Tile Layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
        
        // Data IIPL dari Excel
        const iiplScores = {
            "Kota Surabaya": 0.4247,
            "Kab. Lamongan": 0.2380,
            "Kab. Malang": 0.2204,
            "Kota Kediri": 0.2124,
            "Kab. Banyuwangi": 0.1982,
            "Kab. Pasuruan": 0.1947,
            "Kab. Kediri": 0.1864,
            "Kab. Gresik": 0.1716,
            "Kota Blitar": 0.1705,
            "Kab. Sidoarjo": 0.1695,
            "Kab. Tuban": 0.1536,
            "Kab. Mojokerto": 0.1350,
            "Kab. Jombang": 0.1261,
            "Kab. Lumajang": 0.1245,
            "Kota Malang": 0.1183,
            "Kab. Jember": 0.1159,
            "Kota Batu": 0.1145,
            "Kab. Sumenep": 0.1075,
            "Kab. Blitar": 0.1067,
            "Kab. Probolinggo": 0.1039,
            "Kab. Nganjuk": 0.0795,
            "Kota Pasuruan": 0.0770,
            "Kab. Ngawi": 0.0760,
            "Kab. Ponorogo": 0.0681,
            "Kab. Pacitan": 0.0664,
            "Kab. Bojonegoro": 0.0581,
            "Kab. Pamekasan": 0.0564,
            "Kab. Madiun": 0.0554,
            "Kab. Tulungagung": 0.0523,
            "Kab. Situbondo": 0.0512,
            "Kota Mojokerto": 0.0504,
            "Kab. Sampang": 0.0457,
            "Kab. Bondowoso": 0.0446,
            "Kab. Bangkalan": 0.0419,
            "Kab. Trenggalek": 0.0411,
            "Kab. Magetan": 0.0387,
            "Kota Probolinggo": 0.0255,
            "Kota Madiun": 0.0208
        };

        // 3. Fungsi Normalisasi Nama Wilayah
        function normalize(name) {
            const map = {
                "Surabaya": "Kota Surabaya",
                "Malang": "Kab. Malang",
                "Malang (Kota)": "Kota Malang",
                "Kediri": "Kab. Kediri",
                "Kediri (Kota)": "Kota Kediri",
                "Blitar": "Kab. Blitar",
                "Blitar (Kota)": "Kota Blitar",
                "Pasuruan": "Kab. Pasuruan",
                "Pasuruan (Kota)": "Kota Pasuruan",
                "Mojokerto": "Kab. Mojokerto",
                "Mojokerto (Kota)": "Kota Mojokerto",
                "Probolinggo": "Kab. Probolinggo",
                "Probolinggo (Kota)": "Kota Probolinggo",
                "Madiun": "Kab. Madiun",
                "Madiun (Kota)": "Kota Madiun",
                "Batu": "Kota Batu",
                "Jember": "Kab. Jember",
                "Lumajang": "Kab. Lumajang",
                "Bondowoso": "Kab. Bondowoso",
                "Situbondo": "Kab. Situbondo",
                "Banyuwangi": "Kab. Banyuwangi",
                "Sidoarjo": "Kab. Sidoarjo",
                "Gresik": "Kab. Gresik",
                "Lamongan": "Kab. Lamongan",
                "Tuban": "Kab. Tuban",
                "Bojonegoro": "Kab. Bojonegoro",
                "Ngawi": "Kab. Ngawi",
                "Magetan": "Kab. Magetan",
                "Madiun": "Kab. Madiun",
                "Nganjuk": "Kab. Nganjuk",
                "Jombang": "Kab. Jombang",
                "Tulungagung": "Kab. Tulungagung",
                "Trenggalek": "Kab. Trenggalek",
                "Ponorogo": "Kab. Ponorogo",
                "Pacitan": "Kab. Pacitan",
                "Sampang": "Kab. Sampang",
                "Pamekasan": "Kab. Pamekasan",
                "Sumenep": "Kab. Sumenep",
                "Bangkalan": "Kab. Bangkalan"
            };
            return map[name] ?? name;
        }

        
        // Fungsi Warna Berdasarkan Skor
        function getColor(score) {
            return score > 0.4 ? '#084081' :
                score > 0.3 ? '#0868ac' :
                score > 0.2 ? '#2b8cbe' :
                score > 0.1 ? '#4eb3d3' :
                '#ccece6';
        }
        
        // Load GeoJSON
        fetch('35_jawa_timur.json')
            .then(res => res.json())
            .then(data => {
                L.geoJson(data, {
                    style: function(feature) {
                        const rawName = feature.properties.NAME_2;
                        const name = normalize(rawName);
                        const score = iiplScores[name];
                        return {
                            fillColor: getColor(score),
                            weight: 1,
                            opacity: 1,
                            color: 'white',
                            fillOpacity: 0.7
                        };
                    },
                    onEachFeature: function(feature, layer) {
                        const rawName = feature.properties.NAME_2;
                        const name = normalize(rawName);
                        const score = iiplScores[name];
                        layer.bindPopup(`<strong>${name}</strong><br>IIPL Score: ${score ?? 'Data tidak tersedia'}`);
                    }
                }).addTo(map);
            });
    </script>
</body>
</html>

